apiVersion: hostedcluster.densityops.com/v1alpha1
kind: DNSServer
metadata:
  labels:
    app.kubernetes.io/name: oooi
    app.kubernetes.io/managed-by: kustomize
  name: dnsserver-sample
spec:
  # NetworkConfig defines the DNS server network settings
  # SecondaryNetworkCIDR is used by view plugin for source-based routing
  networkConfig:
    serverIP: "192.168.100.3"  # DNS server IP on secondary network (Multus)
    proxyIP: "192.168.100.10"   # Envoy proxy IP that HCP endpoints resolve to
    secondaryNetworkCIDR: "192.168.100.0/24"  # CIDR for view plugin matching
    dnsPort: 53
    networkAttachmentName: "tenant-vlan-100"
    networkAttachmentNamespace: "default"
  
  # Hosted cluster domain (constructed from ClusterName + BaseDomain)
  hostedClusterDomain: "my-cluster.example.com"
  
  # Static DNS entries visible ONLY from secondary network CIDR (split-horizon)
  # View plugin uses incidr(client_ip(), secondaryNetworkCIDR) to route queries
  # Queries from secondary network see these entries; pod network does not
  staticEntries:
    - hostname: "api.my-cluster.example.com"
      ip: "192.168.100.10"
    - hostname: "api-int.my-cluster.example.com"
      ip: "192.168.100.10"
    - hostname: "oauth-openshift.apps.my-cluster.example.com"
      ip: "192.168.100.10"
    - hostname: "console-openshift-console.apps.my-cluster.example.com"
      ip: "192.168.100.10"
    - hostname: "*.apps.my-cluster.example.com"
      ip: "192.168.100.10"
  
  # Upstream DNS servers for non-HCP queries (both views use these)
  upstreamDNS:
    - "8.8.8.8"
    - "8.8.4.4"
  
  # Container image
  image: "quay.io/cldmnky/oooi:latest"
  
  # CoreDNS tuning
  reloadInterval: "5s"  # How often to check for Corefile changes
  cacheTTL: "30s"       # DNS response cache duration
