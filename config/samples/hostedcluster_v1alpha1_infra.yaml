apiVersion: hostedcluster.densityops.com/v1alpha1
kind: Infra
metadata:
  labels:
    app.kubernetes.io/name: oooi
    app.kubernetes.io/managed-by: kustomize
  name: infra-sample
spec:
  networkConfig:
    cidr: "192.168.100.0/24"
    gateway: "192.168.100.1"
    networkAttachmentDefinition: "test-vlan-100"
    # Optional: Specify the namespace where the NetworkAttachmentDefinition resides
    # If not specified, defaults to the Infra CR's namespace
    networkAttachmentNamespace: "default"
    # Upstream DNS servers for CoreDNS to forward non-HCP queries to
    # These are NOT the DNS servers assigned to DHCP clients
    # When dns.enabled=true, DHCP clients get the CoreDNS server IP automatically
    dnsServers:
      - "8.8.8.8"
      - "8.8.4.4"
  
  infraComponents:
    dhcp:
      enabled: true
      serverIP: "192.168.100.2"
      rangeStart: "192.168.100.10"
      rangeEnd: "192.168.100.250"
      leaseTime: "1h"
    
    dns:
      enabled: true  # When enabled, DHCP automatically uses dns.serverIP
      serverIP: "192.168.100.3"  # VMs get this as their DNS server via DHCP
      baseDomain: "example.com"
      clusterName: "mycluster"
    
    proxy:
      enabled: true
      serverIP: "192.168.100.4"
      proxyImage: "envoyproxy/envoy:v1.36.4"
      managerImage: "quay.io/cldmnky/oooi:latest"
